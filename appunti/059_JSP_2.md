# corso JSP

* JSP è una specifica di Sun Microsystems, poi acquistata da Oracle 
* Serve per creare e gestire pagine web dinamiche
* Permette di mescolare in una pagina codice HTML per generare la parte statica, con contenuto dinamico generato a partire da marcatori speciali <% .... %>
* Il contenuto dinamico si ottiene grazie alla possibilità di incorporare nella pagina codice Java di differenti forme
* L’obiettivo finale è separare l’interfaccia (presentazione visuale) dalla implementazione (logica di esecuzione)

---
## pagina JSP -> Servlet

* La pagina JSP si converte in un servlet (il servlet o la servlet? leggi qui la discussione funny )
* La conversione la realizza il motore o contenitore JSP (tomcat, glassfish, ...), la prima volta che si sollecita la pagina JSP
* Questo servlet generato processa qualsiasi richiesta per questa pagina JSP
* Se si modifica il codice della pagina JSP, allora si rigenera e ricompila automaticamente il servlet e si ricarica la volta successiva

---
## oggetti impliciti JSP utilizza gli oggetti impliciti (built-in)

* Gli oggetti impliciti sono oggetti istanziati automaticamente dall’ambiente JSP, non dobbiamo preoccuparci di importarli e istanziarli.
* Per utilizzarli è sufficiente usare la sintassi nomeOggetto.nomeMetodo

---
## questi oggetti sono disponibili per l’uso in pagine JSP e sono:

* `out`: per scrivere codice HTML nella risposta (System.out di Java)
* `session`: dati specifici della sessione utente corrente
* `request`: richiesta HTTP ricevuta e i suoi attributi, header, cookie, parametri, etc.
* `page`: la pagina e le sue proprietà.
* `config`: dati di configurazione
* `response`: risposta HTTP e le sue proprietà.
* `application`: dati condivisi da tutte le pagine della web application
* `exception`: eventuali eccezioni lanciate dal server; utile per pagine di errore
* `pageContext`: dati di contesto per l’esecuzione della pagina

---
## Gli oggetti impliciti possono essere

* oggetti legati alla servlet relativa alla pagina JSP
* oggetti legati all’input e all’output della pagina JSP
* oggetti che forniscono informazioni sul contesto in cui la JSP viene eseguita
* oggetti risultanti da eventuali errori

---
## Ambito 
Definisce dove e per quanto tempo saranno accessibili gli oggetti: oggetti impliciti, JavaBeans, ...

* di **pagina**: l'oggetto è accessibile dal servlet che rappresenta la pagina
* di **richiesta**: l'oggetto viene creato e poi distrutto dopo l'uso
* di **sessione**: l'oggetto è accessibile durante tutta la sessione
* di **applicazione**: l'oggetto è accessibile dal servlet che rappresenta la pagina

---
## Ciclo di vita di una pagina JSP 
La pagina viene salvata in una cartella pubblica del server web alla prima richiesta ricevuta dal Web server la pagina JSP è automaticamente:

* tradotta in un sorgente Java chiamato **Servlet**
* compilata come programma Java
* caricata in memoria ed eseguita

---
### successivamente 
la pagina JSP (la servlet) viene solo eseguita. In fase di debug il web server verifica se la pagina JSP è più recente del servlet corrispondente.

* Rispetto ad altre tecnologie server side come PHP o ASP, questa è una differenza vantaggiosa in termini di velocità di risposta: dopo la prima esecuzione, il codice risulterà già compilato e disponibile immediatamente.
* Con PHP e ASP il webserver interpreterà il codice ad ogni richiesta prima di servire la pagina di risposta.

---
## Elementi di una pagina JSP

* codice HTML

* marcatori JSP

* direttive al server

* `<%@ direttive %>`

* elementi di scripting

* `<%! dichiarazioni %>`

* `<%= espressioni %>`

* `<% scriptlet %>`

* `<%-- commenti --%>`

* azioni standard

  * `<jsp:include>`

  * `<jsp:forward>`

  * `<jsp:param>`

  * `<jsp:useBean>`

  * `<jsp:setProperty>`

  * `<jsp:getProperty>`

  * `<jsp:plugin>`

* azioni personalizzate - custom tags (vedi sotto tag libraries)

---
## Costrutti del linguaggio 

Supporta i costrutti e la sintassi standard di Java, ecco alcuni esempi:

esempi disponibili:

* variabili

* costrutti condizionali (if, if else, switch case)

* cicli for

* cicli while

* cicli while, do-while

* eccezioni e blocchi try catch

* array

* array di stringhe

* array tipo intero

* array tipo List

* array tipo Vector

* array multidimensionale

---
## JDBC e interazione con database

* Leggi scrivi su file di testo
* Leggi e scrivi su database
* Applicazione CRUD con JSP

---
## Le Tag Libraries

* JSTL

* core

* xml

* frm

* sql

* functions

* Librerie di Tag personalizzate

* EL - expressions language - espressioni dinamiche

---

Linguaggio di scripting predefinito
Il linguaggio di scripting di una pagina JSP viene impostato automaticamente su Java
Inserire la seguente riga in una pagina JSP per configurare la pagina per l'utilizzo di JavaScript:

`<%@  page language = "javascript" %>`

spazi bianchi
Gli spazi bianchi contenuti nel codice vengono restituiti al client così come sono stati inserito nel JSP.

Quoting attribute values
Si possono usare virgolette singole o doppie, per tutti gli elementi JSP

For esempio: 
`<%@  page contentType = "text/plain" %>`

Un commento JSP non viene inviato al client come parte dell'output della pagina JSP

`<%-- Comment string..--%>`

I commenti HTML vengono inviati al client

`<!-- comments -->`

### `page`
Definisce gli attributi a livello di pagina.

`<%@ page attribute="value" ..%>` 

#### attributes, with default values, are:

* attribute = language="java"
* session="true"
* contentType=text/html;charset="ISO-8859-1"
* import="package(s)"
* buffer="8kb"
* autoflush="true"
* isThreadSafe="true"
* info="text_string"
* errorPage="relativeURL"
* isErrorpage="true"
* extends="class_name"value = a string literal in single or double quotes

### include
Inserisce testo in una pagina JSP
`<%@ include file = "path" ..%>`

### taglib
Definisce una custom tag library per una pagina JSP.

`<%@ taglib uri="tagLibraryURI" prefix="tagPrefix" %>`

Dopo la direttiva taglib, fai riferimento ai tag personalizzati usando la sintassi:

`<tagPrefix:tagName>...</tagPrefix:tagName>`

### declaration
Crea definizioni a livello di pagina come variabili.

`<%! declaration %>`

#### esempio:
<%! private String foo = null;public String getFoo() {return this.foo;} %>

### scriptlet
Contiene un blocco di codice di scripting
Una pagina JSP può contenere più blocchi di codice di scripting.

`<% script code %>`

#### esempio:
`<%  String greeting =request.getParameter("Greeting");out.println(greeting); %>`

### expression
Definisce le dichiarazioni valutate sul server prima di inviare l'output della pagina al client.

`<%= expression %>`
#### esempio:
`<%= myVar1%>`

### jsp:include 
Chiama una pagina JSP da un'altra

Al termine, la pagina di destinazione restituisce il controllo alla pagina chiamante.

```java
<jsp:include page="path" flush="true"/>
<jsp:include page="path" flush="true">
<jsp:param name="paramName" value="paramValue" /> ..
</jsp:include>
```

### jsp:forward
Chiama una pagina JSP da un'altra

L'esecuzione della pagina chiamante viene terminata dalla chiamata

```java
<jsp:forward page="path" />
<jsp:forward page="path">
<jsp:param name="paramName" value="paramValue" /> ..
</jsp:forward>
```


### jsp:plugin

<jsp:plugin type="bean|applet"code="objectCode"codebase="objectCodebase"
{ align="alignment" }
{ archive="archiveList" }
{ height="height" }
{ hspace="hspace" }
{ jreversion="jreversion" }
{ name="componentName" }
{ vspace="vspace" }
{ width="width" }
{ nspluginurl="url" }
{ iepluginurl="url" } >
{ <jsp:params>
{ <jsp:param name="paramName"value="paramValue" /> }+</jsp:params> }
{ <jsp:fallback> arbitrary_text</jsp:fallback> } ></jsp:plugin>
The elements in brackets ({}) are optional.

### jsp:useBean
Defines an instance of a Java bean.
<jsp:useBean id="name" scope="page|request|session|application" typeSpec />
<jsp:useBean id="name" scope="page|request|session|application"typeSpec >body</jsp:useBean>

typespec is any one of the following: 
class="className" 
class="className" type="typeName" 
beanName="beanName" type=" typeName" 
type="typeName"

### jsp:setProperty
Sets the value of one or more properties in a bean.
<jsp:setPropertyname="beanName" prop_expr />

prop_expr has one of the following forms: 
property="*" 
property="propertyName"
property="propertyName" param="parameterName"
property="propertyName" value="propertyValue"

### jsp:getProperty
Writes the value of a bean property as a string to the outobject.
<jsp:getProperty name="name" property="propertyName" />

### response
The response to the client.
Java type: javax.servlet.HttpServletResponse

### session
The session object created for the requesting client.
Java type: javax.servlet.http.HttpSession 

---

### Esercizio 1
Scrivere il codice di una pagina JSP che legga da una form due numeri interi e produca come risultato la somma dei due numeri. 

```html
<html>
<head>
 <title>Somma di Interi</title>
</head>
 <body>
  <h3>Inserisci due Numeri interi:</h3>
   <form action="somma.jsp" method="POST">
    Inserisci il primo numero
     <input type="text" name="n1"/><br />
    Inserisci il secondo numero
     <input type="text" name="n2"/><br />

<br />
    <input type="submit" value="somma!!">
   </form>
 </body>
</html>
```


```html
<!DOCTYPE HTML>

<html>

  <head>
  <meta charset="utf-8">
  <title>la somma dei numeri</title></head>
  <body>
    La somma dei numeri che hai inserito è
    <%
    int numero1 = Integer.parseInt(request.getParameter("n1"));
    int numero2 = Integer.parseInt(request.getParameter("n2"));
    int ris= numero1 + numero2;
    %>
    <%= ris%>

  </body>
</html>
```

### Esercizio 2
Scrivere una pagina JSP che contenga una form in cui si chiede all'utente che colore desideri per lo sfondo della pagina. Come action della form selezionare la pagina stessa. Per cambiare colore utilizzare in HTML: <body bgcolor="nomeColore">. Ricordare che i valori dei parametri passati dall'utente sono uno dei campi della variabile implicita request e che potete accedervi con il metodo String request.getParameter(String "nomeParametro"). 
SOLUZIONE 


```html

<!DOCTYPE HTML>

<html>
  <head>
  <meta charset="utf-8">
  <title>Coloro Sfondo</title></head>

  <%
  String Colore = request.getParameter("coloreScelto");

  if(Colore == null) {
    Colore = "white";
  }
  %>

  <body bgcolor="<%= Colore%>">

  <b>Scegli il colore dello sfondo ! !</b>

  <form action="colore.jsp" method="POST">
    <input type="radio" name="coloreScelto" value="white">Bianco<br />
    <input type="radio" name="coloreScelto" value="red">Rosso<br />
    <input type="radio" name="coloreScelto" value="green">Verde<br />
    <input type="radio" name="coloreScelto" value="yellow">Giallo<br />
    <input type="radio" name="coloreScelto" value="pink" checked="checked">Rosa<br />

    <br />
    <input type="submit" value="Colora!!">
  </form>

  </body>
</html>
```


### Esercizio 3

Scrivere il codice per una semplice form HTML che chieda all'utente di autenticarsi con username e password. Verificare se lo username e la password coincidono con quelli "giusti" (confrontateli con due stringhe a vostro piacimento). Se coincidono, visualizzare un messaggio di benvenuto, seguito da nome e cognome letto (es. Benvenuto Paolo Rossi); altrimenti viene visualizzato il messaggio “Username o password errati”. 
```html

<html>
<head>
 <title>Autenticazione</title>
</head>
 <body>
  <h3>Inserimento dei dati</h3>
   <form action="aut.jsp" method="POST">
    Inserisci lo <i>user</i>
    <input type="text" name="user"/><br />

    Inserisci la <i>password</i>
    <input type="password" name="pw"/><br />

<br />
    <input type="submit" value="accedi">
   </form>
 </body>
</html>
```


```html
<!DOCTYPE HTML>

<html>

  <head>
  <meta charset="utf-8">
  <title>Autenticazione</title></head>
  <body>

  <%
   String user = request.getParameter("user");
   String pw = request.getParameter("pw");
    if (user.equals("denis") && pw.equals("te"))
     { 
     %>
     <h1>Benvenuto <b><%= user%></b></h1>
     <%
     }
      else {
      %>Username o Password sbagliati!
      <%}%>
  </body>
</html>
```


---
### Edizioni del corso

* Anno formativo 2018-2019 - "Tecnico di sviluppo software (Java)", Corsi MDL, formatemp, Torino
* Anno formativo 2017-2018 - "Tecnico di sviluppo software (Java)", Corsi MDL, formatemp, Torino
* Anno formativo 2016-2017 - "Tecnico di sviluppo software (Java)", Corsi MDL, formatemp, Torino
* Anno formativo 2015-2016 - "Tecnico di sviluppo software (Java)", Corsi MDL, formatemp, Torino
* Anno formativo 2013 - "Programmazione web server-side con JSP" - corso IFTS - ITIS Pininfarina (TO)
